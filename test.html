创建并连接到 Amazon Timestream 数据库
使用 Amazon Timestream
在本教程中，您将学习如何创建环境来运行 Timestream 数据库和表，连接到该数据库和表，导入样本时序数据，以及查询和分析时序数据。 在本教程中，我们将使用 Amazon Timestream执行此操作。
单击此处时，AWS 管理控制台将在新的浏览器窗口中打开，因此您可以将本分步指南保持打开状态。加载此屏幕后，在数据库下找到 Amazon Timestream，然后单击以打开 Amazon Timestream 控制台。
 

（单击以缩放）
步骤 1：创建 Timestream 数据库
在此步骤中，我们将使用 Amazon Timestream 创建数据库
 
a. 在 Amazon Timestream 控制台的右上角，选择要在其中创建数据库实例的地区。
注意：Amazon 云计算资源位于世界不同地区的高可用性数据中心设施中。每个地区包含多个不同的位置，称为“可用区”或 AZ。您可以选择托管 Amazon Timestream 活动的地区。 
 

（单击以缩放）
 
b.  在console右侧, 单击创建数据库。
  

（单击以缩放）
 
c. 输入数据库名，保留其它缺省设置，然后单击 create database（选择）。
  

（单击以缩放）
 
d.选中刚创建的数据库，创建表。
  
 

（单击以缩放）
 
e. 创建Timestream表， 设置表名和内存数据和磁性存储数据保留时长：
单击 Create table
  

（单击以缩放）
 
f.采用Python样本程序，导入时序样本数据。
•	有关python访问Amazon Timestream更多信息，请参阅Python访问Timesteam样本程序。
 

(单击以缩放)
 
g.在Timestream表中 查看新导入的时序样本数据。 单击Query Table
 

(单击以缩放)
 
步骤 3：集成Grafana 查询和分析Amazon Timestream时序数据
a.	下载和安装Grafana, 在Grafana中安装Timestream插件、集成Timestream和配置Grafana, 有关集成Grafana的更多信息，请参阅Timestream如何集成Grafana
 

(单击以缩放)
 
b.	配置连接Amazon Timestream数据源。
 

(单击以缩放)
 

c.	在Grafana Dashboard中创建Panel 查询Amazon Timestream数据
查询基于以下sql 构建 （计算过去2小时内特定EC2主机的平均CPU利用率p90、p95和p99。以15秒为一个采样间隔）：
SELECT region, az, hostname, BIN(time, 15s) AS binned_timestamp,
    ROUND(AVG(measure_value::double), 2) AS avg_cpu_utilization,
    ROUND(APPROX_PERCENTILE(measure_value::double, 0.9), 2) AS p90_cpu_utilization,
    ROUND(APPROX_PERCENTILE(measure_value::double, 0.95), 2) AS p95_cpu_utilization,
    ROUND(APPROX_PERCENTILE(measure_value::double, 0.99), 2) AS p99_cpu_utilization
FROM "iot".host_metrics
WHERE measure_name = 'cpu_utilization'
    AND hostname = 'host-fj2hx'
    AND time > ago(2h)
GROUP BY region, hostname, az, BIN(time, 15s)
ORDER BY binned_timestamp ASC；
 

恭喜您！
您已使用 Amazon Timestream 创建、连接和查询Amazon Timestream数据库。 使用 Amazon Timestream，您可以在云中轻松创建、查询和分析时序数据库。作为一款面向物联网和运营应用的全新时序数据库，Amazon Timestream每天可处理数万亿规模的时序事件，速度比关系型数据库快多达1000倍，而成本却低至其1/10。Amazon Timestream是一款无服务器服务，它可以自动扩大或缩小规模，根据负载调整容量，客户无需管理其底层基础设施。客户无需预付费或承诺即可使用 Amazon Timestream，仅需为写入、存储或查询的数据付费。
访问 https://aws.amazon.com/timestream即可开始使用 Amazon Timestream。
